(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["68cb6994"],{"2eb5":function(e,s,t){},4163:function(e,s,t){"use strict";var a=t("2eb5"),o=t.n(a);o.a},bd8c:function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"container"},[t("div",{staticClass:"name"},[t("h3",[e._v("Name："+e._s(e.userName))]),t("div",{staticClass:"reset",on:{click:function(s){return e.setName()}}},[e._v("Reset Name")])]),t("div",{staticClass:"chatRoom",staticStyle:{width:"450px"}},[e._m(0),t("div",{staticClass:"roomBody",attrs:{id:"js-roomBody"}},[e._l(e.messages,(function(s){return[s.userName!=e.userName?[t("div",{key:s.id,staticClass:"messageBox"},[t("img",{staticClass:"messageBox__user",attrs:{src:"https://lorempixel.com/40/40/",draggable:"false"}}),t("div",{staticClass:"messageBox__content"},[t("div",{staticClass:"messageBox__name"},[e._v(e._s(s.userName))]),"text"==s.type?t("div",{staticClass:"messageBox__message"},[t("div",{staticClass:"messageBox__text"},[e._v(e._s(s.message))]),t("div",{staticClass:"messageBox__readMore",on:{click:function(s){return e.readMore(s)}}},[e._v("顯示更多")])]):e._e(),"image"==s.type?t("div",{staticClass:"messageBox__image"},[t("img",{attrs:{src:s.message}})]):e._e()]),t("div",{staticClass:"messageBox__time"},[e._v(e._s(s.timeStamp))])])]:e._e(),s.userName==e.userName?[t("div",{key:s.id,staticClass:"messageBox messageBox--self",on:{mouseenter:function(t){e.hoverMessageId=s.id},mouseleave:function(s){e.hoverMessageId=null}}},[t("div",{staticClass:"messageBox__time"},[e._v(e._s(s.timeStamp))]),t("div",{staticClass:"messageBox__content"},["text"==s.type?t("div",{staticClass:"messageBox__message"},[t("div",{staticClass:"messageBox__text"},[e._v(e._s(s.message))])]):e._e(),"image"==s.type?t("div",{staticClass:"messageBox__image"},[t("img",{attrs:{src:s.message}})]):e._e()]),e.hoverMessageId===s.id?t("div",{staticClass:"messageBox__delete"},[t("span",{on:{click:function(s){return e.deleteMessage(e.hoverMessageId)}}},[e._v("刪除")])]):e._e()])]:e._e()]})),t("div",{directives:[{name:"show",rawName:"v-show",value:e.upload,expression:"upload"}],staticClass:"messageBox messageBox--self"},[t("div",{staticClass:"messageBox__progress"},[t("div",{staticClass:"messageBox__progress--state",attrs:{id:"js-progressBar"}}),t("div",{staticClass:"messageBox__progress--number"},[e._v(e._s(e.progress))])])])],2),t("div",{staticClass:"roomBottom",class:{disable:!e.userName}},[t("div",{staticClass:"roomBottom__tools"},[t("div",{staticClass:"roomBottom__tools_upload"},[t("input",{attrs:{type:"file",accept:"image/*"},on:{change:function(s){return e.sendImage(s)}}}),t("img",{attrs:{src:"assets\\sad.svg"}})])]),t("div",{staticClass:"roomBottom__input"},[t("textarea",{staticClass:"roomBottom__input__textarea",class:{disable:!e.userName},attrs:{id:"js-message"},on:{keydown:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.sendMessage(s)}}})])])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.userNameSet||""==e.userName,expression:"userNameSet || userName == ''"}],staticClass:"modal"},[t("div",{staticClass:"modal__container"},[e._m(1),t("div",{staticClass:"modal__body"},[t("input",{staticClass:"userName",attrs:{type:"text",id:"js-userName",maxlength:"6"},domProps:{value:e.userName},on:{keydown:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.saveName()}}}),t("div",{staticClass:"button",on:{click:function(s){return e.saveName()}}},[e._v("設定")])]),t("footer",{staticClass:"modal__footer"})])])])},o=[function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"roomHead"},[t("div",{staticClass:"roomHead__topButtons"},[t("div",{staticClass:"roomHead__button close"}),t("div",{staticClass:"roomHead__button minimize"}),t("div",{staticClass:"roomHead__button zoom"})]),t("img",{staticClass:"roomHead__img",attrs:{src:"https://lorempixel.com/50/50/",draggable:"false"}}),t("div",{staticClass:"roomHead__title"},[e._v("Test Room")])])},function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("header",{staticClass:"modal__header"},[t("h2",{staticClass:"view-title"},[e._v("輸入名稱")])])}],r=(t("8e6e"),t("8a81"),t("c47a")),i=t.n(r),n=(t("ac6a"),t("cadf"),t("06db"),t("456d"),t("7f7f"),t("8aa5")),c=t.n(n);function m(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s&&(a=a.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?m(t,!0).forEach((function(s){i()(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m(t).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}var u=c.a.database().ref("/messages/"),d=c.a.storage().ref("/images/"),_={name:"ChatRoom",data:function(){return{hoverMessageId:null,userNameSet:!1,userName:"",messages:[],upload:!1,progress:""}},methods:{setName:function(){var e=this;e.userNameSet=!0},saveName:function(){var e=this,s=document.querySelector("#js-userName").value;""!=s.trim()&&(e.userName=s,e.userNameSet=!1)},getTime:function(){var e=new Date,s=e.getHours(),t=e.getMinutes();return"".concat(s>=12?"下午":"上午"," ").concat(s,":").concat(t<10?"0"+t:t)},sendMessage:function(e){var s=this,t=document.querySelector("#js-userName"),a=document.querySelector("#js-message");return!e.shiftKey&&(a.value.length<=1&&""==a.value.trim()?(e.preventDefault(),!1):(u.push({userName:t.value,type:"text",message:a.value,timeStamp:s.getTime()}),a.value="",void e.preventDefault()))},sendImage:function(e){var s=this,t=document.querySelector("#js-userName"),a=e.target.files[0],o=Math.floor(Date.now()/1e3)+"_".concat(a.name),r={contentType:"image/*"},i=document.querySelector("#js-progressBar"),n=d.child(o).put(a,r);n.on(c.a.storage.TaskEvent.STATE_CHANGED,(function(e){var t=Math.floor(e.bytesTransferred/e.totalBytes*100);t<100&&(s.upload=!0,s.progress="".concat(t,"%"),i.setAttribute("style","width:".concat(t,"%")))}),(function(e){u.child("bug/").push({userName:t.value,type:"image",message:e.code,timeStamp:s.getTime()})}),(function(){var e=n.snapshot.downloadURL;u.push({userName:t.value,type:"image",message:e,timeStamp:s.getTime()}),s.upload=!1}))},deleteMessage:function(e){var s=u.child(e);s.remove()},readMore:function(e){e.target.previousElementSibling.setAttribute("style","max-height: 100%;"),e.target.setAttribute("style","display: none;")}},mounted:function(){var e=this;u.on("value",(function(s){var t=s.val(),a=t?Object.keys(t).map((function(e){return l({id:e},t[e])})):null;e.messages=a}))},updated:function(){var e=document.querySelectorAll(".messageBox__message");e.forEach((function(e){e.offsetHeight>300&&e.querySelector(".messageBox__readMore").setAttribute("style","display: block")}));var s=document.querySelector("#js-roomBody");s.scrollTop=s.scrollHeight}},v=_,g=(t("4163"),t("2877")),p=Object(g["a"])(v,a,o,!1,null,"8bbb53ea",null);s["default"]=p.exports}}]);